# This module defines the constants that are used by the Paymentech gateway.
module PaymentechGatewayConstants      
  TEST_URL = 'https://wsvar.paymentech.net/PaymentechGateway'
  LIVE_URL = 'https://ws.paymentech.net/PaymentechGateway'

  TRANS_TYPE = {
    :auth_only => 'A',
    :auth_mark_capture => 'AC',
    :force_capture => 'FC',
    :refund => 'R',
  }
  
  PROC_OK = '0'
      
  RESPONSE_CODES = {
    '00' => {:status => :approved, :action => :none,   :message => "Approved"},
    '01' => {:status => :declined, :action => :voice,  :message => "Call/Refer to Card Issuer"},
    '02' => {:status => :declined, :action => :voice,  :message => "Refer to Card issuer's special conditions"},
    '03' => {:status => :error,    :action => :fix,    :message => "Invalid Merchant Number"},
    '04' => {:status => :declined, :action => :cust,   :message => "Pickup"},
    '05' => {:status => :declined, :action => :cust,   :message => "Do Not Honor"},
    '06' => {:status => :declined, :action => :cust,   :message => "Other Error"},
    '07' => {:status => :declined, :action => :cust,   :message => "Stop Deposit Order"},
    '08' => {:status => :approved, :action => :none,   :message => "Approved authorization, honor with identification"},
    '09' => {:status => :declined, :action => :cust,   :message => "Revocation of Auth"},
    '10' => {:status => :declined, :action => :voice,  :message => "Default Call"},
    '11' => {:status => :approved, :action => :none,   :message => "Approved authorization, VIP Approval"},
    '12' => {:status => :declined, :action => :cust,   :message => "Invalid Transaction Type"},
    '13' => {:status => :declined, :action => :fix,    :message => "Bad Amount"},
    '14' => {:status => :declined, :action => :fix,    :message => "Invalid Credit Card Number"},
    '15' => {:status => :declined, :action => :voice,  :message => "Default Call Low Fraud", :fraud => true},
    '16' => {:status => :declined, :action => :voice,  :message => "Default Call Medium Fraud", :fraud => true},
    '17' => {:status => :declined, :action => :voice,  :message => "Default Call High fraud", :fraud => true},
    '18' => {:status => :declined, :action => :voice,  :message => "Default Call Unavailable Fraud", :fraud => true},
    '19' => {:status => :error,    :action => :resend, :message => "Re-enter Transaction"},
    '20' => {:status => :declined, :action => :cust,   :message => "Floor Low Fraud", :fraud => true},
    '21' => {:status => :declined, :action => :cust,   :message => "Floor Medium Fraud", :fraud => true},
    '22' => {:status => :declined, :action => :cust,   :message => "Floor High Fraud", :fraud => true},
    '23' => {:status => :declined, :action => :cust,   :message => "Floor Unavailable Fraud", :fraud => true},
    '24' => {:status => :approved, :action => :none,   :message => "Validated"},
    '26' => {:status => :approved, :action => :none,   :message => "Pre-noted"},
    '27' => {:status => :declined, :action => :cust,   :message => "No reason to decline"},
    '28' => {:status => :approved, :action => :none,   :message => "Received and stored"},
    '29' => {:status => :approved, :action => :none,   :message => "Provided Auth"},
    '30' => {:status => :error,    :action => :fix,    :message => "Invalid value in message"},
    '31' => {:status => :approved, :action => :none,   :message => "Request received"},
    '32' => {:status => :approved, :action => :none,   :message => "BIN Alert"},
    '33' => {:status => :declined, :action => :cust,   :message => "Card is expired"},
    '34' => {:status => :approved, :action => :none,   :message => "Approved for partial"},
    '35' => {:status => :error,    :action => :fix,    :message => "Zero Amount"},
    '36' => {:status => :error,    :action => :fix,    :message => "Bad Total Auth amount"},
    '37' => {:status => :error,    :action => :fix,    :message => "Invalid Secure Payment Data"},
    '38' => {:status => :declined, :action => :call,   :message => "Merchant not MC SecureCode Enabled"},
    '40' => {:status => :error,    :action => :fix,    :message => "Requested Function not supported"},
    '41' => {:status => :declined, :action => :cust,   :message => "Lost / Stolen"},
    '42' => {:status => :declined, :action => :cust,   :message => "Account Not Active"},
    '43' => {:status => :declined, :action => :cust,   :message => "Lost / Stolen Card"},
    '45' => {:status => :declined, :action => :cust,   :message => "Duplicate Transaction"},
    '46' => {:status => :declined, :action => :fix,    :message => "Blanks not passed in Reserved Field"},
    '50' => {:status => :declined, :action => :cust,   :message => "Positive ID"},
    '52' => {:status => :declined, :action => :cust,   :message => "Processor Decline"},
    '56' => {:status => :declined, :action => :cust,   :message => "Restraint"},
    '58' => {:status => :error,    :action => :call,   :message => "Transaction not permitted to terminal"},
    '59' => {:status => :declined, :action => :cust,   :message => "Soft AVS"},
    '60' => {:status => :declined, :action => :cust,   :message => "Do Not Honor Low Fraud", :fraud => true},
    '61' => {:status => :declined, :action => :cust,   :message => "Do Not Honor Medium Fraud", :fraud => true},
    '62' => {:status => :declined, :action => :cust,   :message => "Do Not Honor High fraud", :fraud => true},
    '63' => {:status => :declined, :action => :cust,   :message => "Do Not Honor Unavailable Fraud", :fraud => true},
    '64' => {:status => :declined, :action => :cust,   :message => "CVV2/CVC2 Failure"},
    '65' => {:status => :declined, :action => :cust,   :message => "Invalid Amex CID"},
    '66' => {:status => :error,    :action => :fix,    :message => "Other Error"},
    '68' => {:status => :error,    :action => :fix,    :message => "Invalid CC Number"},
    '69' => {:status => :error,    :action => :fix,    :message => "Does not match MOP"},
    '71' => {:status => :declined, :action => :fix,    :message => "No Account"},
    '72' => {:status => :declined, :action => :fix,    :message => "Invalid Institution Code"},
    '73' => {:status => :error,    :action => :fix,    :message => "Method of Payment is Invalid for Merchant"},
    '74' => {:status => :declined, :action => :cust,   :message => "Invalid Expiration Date"},
    '75' => {:status => :error,    :action => :fix,    :message => "Bad Amount"},
    '77' => {:status => :declined, :action => :fix,    :message => "Invalid Amount"},
    '78' => {:status => :error,    :action => :fix,    :message => "Missing Companion Data"},
    '79' => {:status => :error,    :action => :fix,    :message => "Invalid Merchant"},
    '80' => {:status => :error,    :action => :fix,    :message => "Invalid MOP for division"},
    '81' => {:status => :declined, :action => :voice,  :message => "Call Low Fraud", :fraud => true},
    '82' => {:status => :declined, :action => :voice,  :message => "Call Medium Fraud", :fraud => true},
    '83' => {:status => :declined, :action => :voice,  :message => "Call High Fraud", :fraud => true},
    '84' => {:status => :declined, :action => :voice,  :message => "Call Unavailable Fraud", :fraud => true},
    '85' => {:status => :error,    :action => :fix,    :message => "Duplicated Order #"},
    '86' => {:status => :error,    :action => :wait,   :message => "Auth Recycle Host down"},
    '87' => {:status => :error,    :action => :fix,    :message => "Invalid Currency"},
    '88' => {:status => :error,    :action => :fix,    :message => "Invalid Purch. Level III"},
    '89' => {:status => :declined, :action => :cust,   :message => "Credit Floor"},
    '91' => {:status => :approved, :action => :none,   :message => "Approved Low Fraud", :fraud => true},
    '92' => {:status => :approved, :action => :none,   :message => "Approved Medium Fraud", :fraud => true},
    '93' => {:status => :approved, :action => :none,   :message => "Approved High Fraud", :fraud => true},
    '94' => {:status => :approved, :action => :none,   :message => "Approved Fraud Service Unavailable"},
    '95' => {:status => :error,    :action => :fix,    :message => "Invalid Data Type"},
    '96' => {:status => :error,    :action => :fix,    :message => "Invalid Record Sequence"},
    '97' => {:status => :error,    :action => :fix,    :message => "Percents Not Total 100"},
    '98' => {:status => :declined, :action => :resend, :message => "Issuer Unavailable"},
    '99' => {:status => :error,    :action => :resend, :message => "No Answer / Unable to send"},
    'A1' => {:status => :error,    :action => :fix,    :message => "Payments Not Total Order"},
    'A2' => {:status => :error,    :action => :fix,    :message => "Bad Order Number"},
    'A3' => {:status => :error,    :action => :wait,   :message => "FPO Locked"},
    'A4' => {:status => :error,    :action => :call,   :message => "FPO Not Allowed"},
    'A5' => {:status => :error,    :action => :fix,    :message => "Auth Amount Wrong"},
    'A6' => {:status => :error,    :action => :fix,    :message => "Illegal Action"},
    'A8' => {:status => :error,    :action => :fix,    :message => "Invalid Start Date"},
    'A9' => {:status => :error,    :action => :fix,    :message => "Invalid Issue Number"},
    'B1' => {:status => :error,    :action => :fix,    :message => "Invalid Transaction Type"},
    'B2' => {:status => :declined, :action => :cust,   :message => "Account Previously Activated"},
    'B3' => {:status => :error,    :action => :fix,    :message => "Unable to void transaction"},
    'B5' => {:status => :declined, :action => :fix,    :message => "Not on file"},
    'B7' => {:status => :declined, :action => :cust,   :message => "Fraud", :fraud => true},
    'B8' => {:status => :declined, :action => :cust,   :message => "Bad Debt"},
    'B9' => {:status => :declined, :action => :cust,   :message => "On Negative File"},
    'BA' => {:status => :declined, :action => :cust,   :message => "Under 18 Years Old"},
    'BB' => {:status => :declined, :action => :cust,   :message => "Possible Compromise"},
    'BC' => {:status => :declined, :action => :cust,   :message => "Bill To Not Equal To Ship To"},
    'BD' => {:status => :declined, :action => :cust,   :message => "Invalid Pre-approval Number"},
    'BE' => {:status => :declined, :action => :cust,   :message => "Invalid Email Address"},
    'BF' => {:status => :declined, :action => :cust,   :message => "PA ITA Number Inactive"},
    'BG' => {:status => :declined, :action => :cust,   :message => "Blocked Account"},
    'BH' => {:status => :declined, :action => :cust,   :message => "Address Verification Failed"},
    'BI' => {:status => :declined, :action => :cust,   :message => "Not on Credit Bureau"},
    'BJ' => {:status => :declined, :action => :cust,   :message => "Previously Declined"},
    'BK' => {:status => :declined, :action => :cust,   :message => "Closed Account, New Account Closed"},
    'BL' => {:status => :declined, :action => :cust,   :message => "Re-Authorization"},
    'BM' => {:status => :declined, :action => :cust,   :message => "Re-Authorization – No Match"},
    'BN' => {:status => :declined, :action => :cust,   :message => "Re-Authorization – Timeframes Exceeded"},
    'BO' => {:status => :declined, :action => :cust,   :message => "Stand In Rules"},
    'BP' => {:status => :error,    :action => :fix,    :message => "Customer Service Phone Number required on Transaction Types 1 (MO/TO) and 2 (Recurring). MC Only"},
    'BQ' => {:status => :declined, :action => :cust,   :message => "Issuer has flagged account as suspected fraud. (Discover Only)", :fraud => true},
    'BR' => {:status => :error,    :action => :fix,    :message => "Invalid MCC Sent"},
    'BS' => {:status => :declined, :action => :cust,   :message => "New Card Issued"},
    'C1' => {:status => :declined, :action => :cust,   :message => "Invalid Issuer"},
    'C2' => {:status => :declined, :action => :fix,    :message => "Invalid Response Code"},
    'C3' => {:status => :declined, :action => :cust,   :message => "Excessive Pin Try"},
    'C4' => {:status => :declined, :action => :cust,   :message => "Over Limit"},
    'C5' => {:status => :declined, :action => :cust,   :message => "Over Freq Limit"},
    'C6' => {:status => :declined, :action => :cust,   :message => "Over Sav limit"},
    'C7' => {:status => :declined, :action => :cust,   :message => "Over Sav Freq"},
    'C8' => {:status => :declined, :action => :cust,   :message => "Over Credit limit"},
    'C9' => {:status => :declined, :action => :cust,   :message => "Over Credit Freq"},
    'D1' => {:status => :declined, :action => :fix,    :message => "Invalid For Credit"},
    'D2' => {:status => :declined, :action => :fix,    :message => "Invalid For Debit"},
    'D3' => {:status => :declined, :action => :cust,   :message => "Rev Exceed Withdrawal"},
    'D4' => {:status => :declined, :action => :cust,   :message => "One Purchasing Limit"},
    'D5' => {:status => :declined, :action => :cust,   :message => "On Negative File"},
    'D6' => {:status => :declined, :action => :fix,    :message => "Changed Field"},
    'D7' => {:status => :declined, :action => :cust,   :message => "Insufficient Funds"},
    'D8' => {:status => :declined, :action => :fix,    :message => "Encrypted Data Bad"},
    'D9' => {:status => :declined, :action => :fix,    :message => "Altered Data"},
    'E3' => {:status => :declined, :action => :fix,    :message => "Invalid Prefix"},
    'E4' => {:status => :declined, :action => :fix,    :message => "Invalid Institution"},
    'E5' => {:status => :declined, :action => :fix,    :message => "Invalid Cardholder"},
    'E6' => {:status => :declined, :action => :fix,    :message => "BIN Block"},
    'E7' => {:status => :approved, :action => :none,   :message => "Stored"},
    'E8' => {:status => :error,    :action => :fix,    :message => "Invalid Transit Routing Number"},
    'E9' => {:status => :error,    :action => :fix,    :message => "Unknown Transit Routing Number"},
    'F1' => {:status => :error,    :action => :fix,    :message => "Missing Name"},
    'F2' => {:status => :error,    :action => :fix,    :message => "Invalid Account Type"},
    'F3' => {:status => :error,    :action => :cust,   :message => "Account Closed"},
    'F4' => {:status => :error,    :action => :fix,    :message => "No Account / Unable To Locate"},
    'F5' => {:status => :error,    :action => :cust,   :message => "Account holder Deceased"},
    'F6' => {:status => :error,    :action => :cust,   :message => "Beneficiary Deceased"},
    'F7' => {:status => :error,    :action => :cust,   :message => "Account Frozen"},
    'F8' => {:status => :error,    :action => :cust,   :message => "Customer Opt Out"},
    'F9' => {:status => :error,    :action => :cust,   :message => "ACH Non-Participant"},
    'G1' => {:status => :error,    :action => :fix,    :message => "No Pre-note"},
    'G2' => {:status => :error,    :action => :fix,    :message => "No Address"},
    'G3' => {:status => :error,    :action => :fix,    :message => "Invalid Account Number"},
    'G4' => {:status => :error,    :action => :cust,   :message => "Authorization Revoked by Consumer"},
    'G5' => {:status => :error,    :action => :cust,   :message => "Customer Advises Not Authorized"},
    'G6' => {:status => :error,    :action => :fix,    :message => "Invalid CECP Action Code"},
    'G7' => {:status => :error,    :action => :fix,    :message => "Invalid Account Format"},
    'G8' => {:status => :error,    :action => :fix,    :message => "Bad Account Number Data"},
    'G9' => {:status => :declined, :action => :na,     :message => "No Capture"},
    'H1' => {:status => :declined, :action => :na,     :message => "No Credit Function"},
    'H2' => {:status => :declined, :action => :na,     :message => "No Debit Function"},
    'H3' => {:status => :declined, :action => :cust,   :message => "Rev Exceed Withdrawal"},
    'H4' => {:status => :declined, :action => :na,     :message => "Changed Field"},
    'H5' => {:status => :declined, :action => :na,     :message => "Terminal Not Owned"},
    'H6' => {:status => :declined, :action => :fix,    :message => "Invalid Time"},
    'H7' => {:status => :declined, :action => :fix,    :message => "Invalid Date"},
    'H8' => {:status => :declined, :action => :fix,    :message => "Invalid Terminal Number"},
    'H9' => {:status => :declined, :action => :cust,   :message => "Invalid PIN"},
    'I1' => {:status => :error,    :action => :fix,    :message => "Block activation failed – Card Range not set up for MOD 10"},
    'I2' => {:status => :error,    :action => :fix,    :message => "Block activation failed – email or fulfillment flags were set to Y Declined – Issuance"},
    'I3' => {:status => :declined, :action => :cust,   :message => "amount doesn’t meet minimum"},
    'I4' => {:status => :declined, :action => :cust,   :message => "Declined – no original auth found"},
    'I5' => {:status => :declined, :action => :cust,   :message => "Declined – outstanding auth, funds on hold"},
    'I6' => {:status => :declined, :action => :fix,    :message => "Activation amount incorrect"},
    'I7' => {:status => :declined, :action => :fix,    :message => "Block activation failed- account not correct or block size not correct"},
    'I8' => {:status => :declined, :action => :fix,    :message => "Mag stripe CVD value failed"},
    'I9' => {:status => :declined, :action => :fix,    :message => "Max Redemption limit met"},
    'J1' => {:status => :declined, :action => :fix,    :message => "No Manual Key"},
    'J2' => {:status => :declined, :action => :fix,    :message => "Not Signed In"},
    'J3' => {:status => :declined, :action => :cust,   :message => "Excessive Pin Try"},
    'J4' => {:status => :declined, :action => :fix,    :message => "No DDA"},
    'J5' => {:status => :declined, :action => :fix,    :message => "No SAV"},
    'J6' => {:status => :declined, :action => :cust,   :message => "Excess DDA"},
    'J7' => {:status => :declined, :action => :cust,   :message => "Excess DDA FREQ"},
    'J8' => {:status => :declined, :action => :cust,   :message => "Excess SAV"},
    'J9' => {:status => :declined, :action => :cust,   :message => "Excess SAV FREQ"},
    'K1' => {:status => :declined, :action => :cust,   :message => "Excess Card"},
    'K2' => {:status => :declined, :action => :cust,   :message => "Excess Card Freq"},
    'K3' => {:status => :declined, :action => :na,     :message => "Reserved Future"},
    'K4' => {:status => :declined, :action => :na,     :message => "Reserved Closing"},
    'K5' => {:status => :declined, :action => :cust,   :message => "Dormant"},
    'K6' => {:status => :declined, :action => :cust,   :message => "NSF"},
    'K7' => {:status => :declined, :action => :na,     :message => "Future RD Six"},
    'K8' => {:status => :declined, :action => :na,     :message => "Future RD Seven"},
    'K9' => {:status => :declined, :action => :fix,    :message => "Transaction Code Conflict"},
    'L1' => {:status => :declined, :action => :wait,   :message => "In Progress"},
    'L2' => {:status => :error,    :action => :resend, :message => "Process Unavailable"},
    'L3' => {:status => :error,    :action => :fix,    :message => "Invalid Expiration"},
    'L4' => {:status => :error,    :action => :fix,    :message => "Invalid Effective"},
    'L5' => {:status => :declined, :action => :fix,    :message => "Invalid Issuer"},
    'L6' => {:status => :declined, :action => :cust,   :message => "Tran not allowed for cardholder"},
    'L7' => {:status => :error,    :action => :call,   :message => "Unable to Determine Network Routing"},
    'L8' => {:status => :error,    :action => :call,   :message => "System Error"},
    'L9' => {:status => :error,    :action => :call,   :message => "Database Error"},
    'M1' => {:status => :declined, :action => :cust,   :message => "Merchant Override Decline"},
    'PA' => {:status => :approved, :action => :na,     :message => "Partial Approval"},
    'PB' => {:status => :declined, :action => :cust,   :message => "Revocation of all Authorization"}
  }
  
  FRAUD_CODES = RESPONSE_CODES.reject{|k,v| v[:fraud] != true}
      
  APPROVAL_CODES = {
    '0' => :declined,
    '1' => :approved,
    '2' => :error
  }
  
  AVS_RESPONSE_CODES = {
    '1' => "No address supplied",
    '2' => "Bill-to address did not pass Auth Host edit checks",
    '3' => "AVS not performed",
    '4' => "Issuer does not participate in AVS",
    '4' => "Issuer does not participate in AVS",
    '5' => "Edit-error - AVS data is invalid",
    '6' => "System unavailable or time-out",
    '7' => "Address information unavailable",
    '8' => "Transaction Ineligible for AVS",
    '9' => "Zip Match / Zip4 Match / Locale match",
    'A' => "Zip Match / Zip 4 Match / Locale no match",
    'B' => "Zip Match / Zip 4 no Match / Locale match",
    'C' => "Zip Match / Zip 4 no Match / Locale no match",
    'D' => "Zip No Match / Zip 4 Match / Locale match",
    'E' => "Zip No Match / Zip 4 Match / Locale no match",
    'F' => "Zip No Match / Zip 4 No Match / Locale match",
    'G' => "No match at all",
    'H' => "Zip Match / Locale match",
    'J' => "Issuer does not participate in Global AVS",
    'JA' => "International street address and postal match",
    'JB' => "International street address match. Postal code not verified.",
    'JC' => "International street address and postal code not verified.",
    'JD' => "International postal code match. Street address not verified.",
    'M1' => "Cardholder name matches",
    'M2' => "Cardholder name, billing address, and postal code matches",
    'M3' => "Cardholder name and billing code matches",
    'M4' => "Cardholder name and billing address match",
    'M5' => "Cardholder name incorrect, billing address and postal code match",
    'M6' => "Cardholder name incorrect, billing address matches",
    'M7' => "Cardholder name incorrect, billing address matches",
    'M8' => "Cardholder name, billing address and postal code are all incorrect",
    'N3' => "Address matches, ZIP not verified.",
    'N4' => "Address and ZIP code match (International only)",
    'N5' => "Address not verified (International only)",
    'N6' => "Address and ZIP code match (International only)",
    'N7' => "ZIP matches, address not verified",
    'N8' => "Address and ZIP code match (International only)",
    'UK' => "Unknown",
    'X' => "Zip Match / Zip 4 Match / Address Match",
    'Z' => "Zip Match / Locale no match",
    nil => "Not applicable (non-Visa)"
  }
  
  CVV_RESP_CODES = {
    'M' => "CVV Match",
    'N' => "CVV No match",
    'P' => "Not processed",
    'S' => "Should have been present",
    'U' => "Unsupported by issuer",
    'I' => "Invalid",
    'Y' => "Invalid",
    nil => "Not applicable (non-Visa)"
  }
  
  # Convenience method for determining whether a request was successful
  # based upon the contents of the response element.
  def new_order_success?(resp_elem)
    resp_elem.procStatus == PROC_OK &&
      RESPONSE_CODES[resp_elem.respCode][:status] == :approved && 
      APPROVAL_CODES[resp_elem.approvalStatus] == :approved
  end

  # Convenience method for determining whether a transaction should be reviewed
  # for fraud based upon the response code received.
  def new_order_fraud_review?(resp_elem)
    FRAUD_CODES.has_key?(resp_elem.respCode)
  end
  
  # Convenience method for determining whether a mark for capture request
  # was successful.
  def mark_capture_success?(resp_elem)
    resp_elem.procStatus == PROC_OK
  end

  # Convenience method for determining whether a mark for capture request
  # was successful.
  def reversal_success?(resp_elem)
    resp_elem.procStatus == PROC_OK
  end
end
